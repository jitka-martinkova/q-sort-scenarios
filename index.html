<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Q-sort – Bariéry práce se scénáři</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    h1, h2 {
      color: #333;
    }

    #main {
      width: 95%;
      max-width: 1400px;
      margin: 20px auto;
      text-align: left;
    }

    .section {
      background: #ffffff;
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.08);
    }

    #participantRow {
      margin-bottom: 15px;
    }

    #participantRow label {
      font-size: 14px;
      margin-right: 8px;
    }

    #participantId {
      padding: 4px 8px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #aaa;
    }

    #consentLabel {
      font-size: 14px;
    }

    #consentCheckbox {
      margin-right: 6px;
    }

    /* TŘÍDICÍ „PARKOVIŠTĚ“ – TŘI BOXY */
    #statements {
      display: flex;
      flex-direction: row;
      gap: 12px;
      justify-content: space-between;
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      background: #ffffff;
      box-shadow: 0 0 6px rgba(0,0,0,0.05);
      box-sizing: border-box;
      width: 100%;
    }

    .bucket {
      flex: 1;
      min-width: 0;
      min-height: 80px;
      border-radius: 6px;
      border: 1px dashed #bbb;
      padding: 6px;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      box-sizing: border-box;
    }

    .bucket-title {
      font-weight: bold;
      font-size: 13px;
      margin-bottom: 4px;
      text-align: left;
    }

    .statement {
      background: white;
      border: 1px solid #ccc;
      padding: 5px;
      margin: 4px 0;
      border-radius: 4px;
      cursor: grab;
      font-size: 12px;
      text-align: left;
      width: 100%;
      box-sizing: border-box;
    }

    /* GRID PRO Q-SORT – PŘES CELOU ŠÍŘKU MAIN */
    #gridWrapper {
      overflow-x: auto;
      margin-top: 20px;
      padding-bottom: 10px;
      width: 100%;
    }

    .grid {
      display: flex;
      justify-content: space-between; /* roztáhne sloupce přes celou šířku */
      width: 100%;                   /* využije celý main container */
    }

    .column {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0; /* žádné mezery mezi sloupci */
    }

    .col-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      min-height: 60px;
      margin-bottom: 0;
    }

    .column-label {
      font-weight: bold;
      margin-top: 2px;
    }

    .col-desc {
      font-size: 11px;
      text-align: center;
      max-width: 130px;
      line-height: 1.2;
    }

    .slot {
      width: 160px;          /* širší kvůli celým textům */
      height: 100px;
      border: 1px solid #aaa;
      margin: 0;             /* žádný margin = přiléhat k sobě vertikálně */
      border-radius: 0;
      font-size: 11px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: left;
      padding: 4px;
      box-sizing: border-box;
    }

    #submitBtn {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: #4CAF50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }

    #submitBtn:hover { background: #45a049; }

    #submitBtn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    #opportunities {
      width: 100%;
      min-height: 100px;
      box-sizing: border-box;
      padding: 8px;
      font-size: 13px;
      border-radius: 4px;
      border: 1px solid #aaa;
      resize: vertical;
    }
  </style>
</head>
<body>
  <div id="main">
    <!-- Hlava stránky + ID respondenta -->
    <h1>Q-sort: Bariéry práce se scénáři</h1>

    <div id="participantRow">
      <label for="participantId">ID účastníka (např. P01):</label>
      <input type="text" id="participantId" placeholder="P01">
    </div>

    <!-- 1) INFORMOVANÝ SOUHLAS -->
    <div class="section" id="section-consent">
      <h2>1) Informovaný souhlas</h2>
      <p id="consentText">
        Potvrďte prosím, že jste se seznámil/a s dokumentem obsahujícím informovaný souhlas
        k tomuto výzkumu a souhlasíte s účastí.
      </p>
      <label id="consentLabel">
        <input type="checkbox" id="consentCheckbox">
        Potvrzuji, že jsem četl/a dokument s informovaným souhlasem, a vyjadřuji s tímto dokumentem svůj souhlas.
      </label>
    </div>

    <!-- 2) Q-TŘÍDĚNÍ -->
    <div class="section" id="section-qsort">
      <h2>2) Q-třídění</h2>
      <p>
        V horním bloku můžete výroky nejprve přibližně roztřídit do tří skupin
        (spíše nesouhlasím, spíše neutrální, spíše souhlasím). Poté prosím
        přetáhněte všechny výroky do mřížky níže a rozmístěte je podle míry souhlasu
        od nejméně po nejvíce souhlasné.
      </p>

      <!-- TŘI PŘEDTŘÍDICÍ BOXY -->
      <div id="statements">
        <div class="bucket" id="bucket1">
          <div class="bucket-title">Spíše nesouhlasím</div>
        </div>
        <div class="bucket" id="bucket2">
          <div class="bucket-title">Spíše neutrální</div>
        </div>
        <div class="bucket" id="bucket3">
          <div class="bucket-title">Spíše souhlasím</div>
        </div>
      </div>

      <!-- GRID PRO Q-SORT -->
      <div id="gridWrapper">
        <div class="grid" id="qgrid"></div>
      </div>
    </div>

    <!-- 3) PŘÍLEŽITOSTI -->
    <div class="section" id="section-opportunities">
      <h2>3) Příležitosti</h2>
      <p>
        Ve zkratce prosím popište, jaké vidíte příležitosti k překonání výše diskutovaných bariér
        ve svém působišti nebo kontextu:
      </p>
      <textarea id="opportunities" placeholder="Vaše odpověď (nepovinné, ale vítané)..."></textarea>
    </div>

    <!-- TLAČÍTKO AŽ NA KONCI STRÁNKY -->
    <div style="text-align: center; margin-bottom: 30px;">
      <button id="submitBtn" onclick="submitData()">Odeslat můj Q-sort</button>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQ4UMNSMGjfUM8EJBA1SGlvakxk_RKEzxEopXB2BJ6a_KLUQ1g4Se7jd5VB0_nyyMW/exec"; // ← sem vlož URL webové aplikace z Apps Scriptu

    // 23 výroků (22 původních + Q23: Placeholder)
    const statements = [
      "Q1: Absence dedikovaných institucionálních kapacit omezuje využívání scénářů.",
      "Q2: Nedostatek koordinace mezi sektory a institucemi omezuje práci se scénáři socio-ekonomického vývoje.",
      "Q3: Nedostatek podmínek pro dlouhodobý, adaptabilní a flexibilní proces brání efektivnímu využití scénářů.",
      "Q4: Nedostatek systematické finanční podpory brání rozvoji a využívání scénářů.",
      "Q5: Scénáře jsou považovány za irelevantní, pokud nepřinášejí nové nebo užitečné poznatky.",
      "Q6: Nedůvěra vůči scénářům, jejich metodám, obsahu či hodnotovým rámcům omezuje jejich využití.",
      "Q7: Nízké povědomí mezi tvůrci politik omezuje využívání scénářů.",
      "Q8: Nedostatek časových kapacit brání pracovníkům využívat scénáře.",
      "Q9: Využití scénářů brání nedostatek dovedností a zkušeností s tímto nástrojem.",
      "Q10: Nízká motivace a angažovanost pracovníků snižují využitelnost scénářů.",
      "Q11: Nedostatek kvalitních dat omezuje tvorbu a použitelnost scénářů.",
      "Q12: Nedostatečné školení a informační podpora snižují schopnost pracovat se scénáři.",
      "Q13: Nekompatibilní časové horizonty scénářů a institucí ztěžují jejich praktické využití.",
      "Q14: Netransparentnost modelování a scénářů snižuje důvěru v jejich využívání.",
      "Q15: Nízká relevance scénářů pro konkrétní rozhodnutí snižuje jejich užitečnost.",
      "Q16: Příliš široké scénáře nejsou využitelné pro specifické potřeby a konflikty, s nimiž instituce pracují.",
      "Q17: Kvalitativní přístupy jsou často opomíjeny, protože rozhodování preferuje kvantitativní technicko-ekonomické metody.",
      "Q18: Práce se scénáři a modelování je vnímána jako příliš složitý a málo flexibilní proces.",
      "Q19: Scénáře mohou být vnímány jako příliš odvážné vzhledem ke konzervativnímu uvažování politických představitelů.",
      "Q20: Nedostatek interních znalostí, zkušeností a kapacit omezuje práci se scénáři.",
      "Q21: Nedostatek neformálních vazeb a sítí mezi institucemi brání spolupráci potřebné pro práci se scénáři.",
      "Q22: Nedostatečná spolupráce s externími experty omezuje porozumění scénářovým procesům.",
      "Q23: Placeholder."
    ];

    // 23 slotů: 2+3+5+5+5+3+2 = 25 (to je 25, takže upravíme na 23: 2+3+4+5+4+3+2 = 23)
    // škála -3 až +3, s jedním slotem navíc u 0 oproti původní 22-slotové verzi
    const distribution = [-3, -2, -1, 0, 1, 2, 3];
    const slotsPerColumn = { "-3":2, "-2":3, "-1":4, "0":5, "1":4, "2":3, "3":2 }; // součet = 23

    let submitting = false;

    // Inicializace po načtení
    window.addEventListener('DOMContentLoaded', () => {
      buildGrid();
      renderStatements();
      enablePoolDrop();
      enableAutoScrollOnDrag();
    });

    function buildGrid() {
      const grid = document.getElementById('qgrid');
      distribution.forEach(val => {
        const col = document.createElement('div');
        col.className = 'column';

        const header = document.createElement('div');
        header.className = 'col-header';

        const desc = document.createElement('div');
        desc.className = 'col-desc';
        if (val === -3) {
          desc.textContent = 'Nejméně odpovídá tomu, co si myslím';
        } else if (val === 0) {
          desc.textContent = 'Neutrální';
        } else if (val === 3) {
          desc.textContent = 'Nejvíce odpovídá tomu, co si myslím';
        } else {
          desc.textContent = '';
        }

        const label = document.createElement('div');
        label.className = 'column-label';
        label.textContent = val;

        header.appendChild(desc);
        header.appendChild(label);
        col.appendChild(header);

        for (let i = 0; i < slotsPerColumn[val]; i++) {
          const slot = document.createElement('div');
          slot.className = 'slot';
          slot.dataset.value = val;
          slot.ondrop = drop;
          slot.ondragover = allowDrop;

          // BARVY: červená pro záporné, zelená pro kladné, střed bílý
          if (val === 0) {
            slot.style.backgroundColor = '#ffffff';
          } else if (val < 0) {
            const alpha = 0.3 + 0.1 * Math.abs(val);
            slot.style.backgroundColor = `rgba(255, 150, 150, ${alpha})`;
          } else if (val > 0) {
            const alpha = 0.3 + 0.1 * Math.abs(val);
            slot.style.backgroundColor = `rgba(150, 255, 150, ${alpha})`;
          }

          col.appendChild(slot);
        }
        grid.appendChild(col);
      });
    }

    function renderStatements() {
      const bucket1 = document.getElementById('bucket1');
      statements.forEach((txt, i) => {
        const div = document.createElement('div');
        div.className = 'statement';
        div.textContent = txt;
        div.draggable = true;
        div.id = 's' + i;
        div.ondragstart = drag;
        bucket1.appendChild(div);
      });
    }

    function enablePoolDrop() {
      const buckets = document.querySelectorAll('.bucket');
      buckets.forEach(bucket => {
        bucket.addEventListener('dragover', allowDrop);
        bucket.addEventListener('drop', (ev) => {
          ev.preventDefault();
          const id = ev.dataTransfer.getData("text");
          if (!id) return;
          const el = document.getElementById(id);
          if (el && el.classList.contains('statement')) {
            bucket.appendChild(el);
          }
        });
      });
    }

    function allowDrop(ev){ ev.preventDefault(); }

    function drag(ev){ ev.dataTransfer.setData("text", ev.target.id); }

    function drop(ev){
      ev.preventDefault();
      const data = ev.dataTransfer.getData("text");
      const card = document.getElementById(data);
      if (ev.target.classList.contains('slot') && ev.target.children.length === 0 && card) {
        ev.target.appendChild(card);
      }
    }

    // Auto-scroll při dragování směrem dolů/nahoru
    function enableAutoScrollOnDrag() {
      document.addEventListener('dragover', function(e) {
        e.preventDefault();
        const margin = 80;
        const y = e.clientY;
        const h = window.innerHeight;

        if (y > h - margin) {
          window.scrollBy({ top: 20, left: 0, behavior: 'smooth' });
        } else if (y < margin) {
          window.scrollBy({ top: -20, left: 0, behavior: 'smooth' });
        }
      });
    }

    function submitData(){
      if (submitting) {
        alert("Váš Q-sort už byl odeslán.");
        return;
      }

      const participantId = document.getElementById('participantId').value.trim();
      if (!participantId) {
        alert("Zadejte prosím ID účastníka (např. P01).");
        return;
      }

      const consentChecked = document.getElementById('consentCheckbox').checked;
      if (!consentChecked) {
        alert("Pro pokračování prosím potvrďte informovaný souhlas.");
        return;
      }

      const results = [];
      const slots = document.querySelectorAll('.slot');
      slots.forEach((slot, index) => {
        if (slot.children.length > 0) {
          const card = slot.children[0];
          results.push({
            slotIndex: index,
            score: slot.dataset.value,
            statementId: card.id,
            statement: card.textContent
          });
        }
      });

      if (results.length < statements.length) {
        alert("Prosím rozmístěte všech 23 výroků do mřížky, než odešlete odpovědi.");
        return;
      }

      const opportunities = document.getElementById('opportunities').value.trim();

      const payload = {
        participantId: participantId,
        consent: true,
        opportunities: opportunities,
        results: results
      };

      const btn = document.getElementById('submitBtn');
      submitting = true;
      btn.disabled = true;

      fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      }).then(()=>{
        btn.textContent = "Q-sort byl odeslán";
        alert("Děkujeme za úspěšné Q-řazení!");
      }).catch(err=>{
        submitting = false;
        btn.disabled = false;
        alert("Při odesílání došlo k chybě: " + err);
      });
    }
  </script>
</body>
</html>

